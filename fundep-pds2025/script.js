function getColor(o){return o>6?"#084081":o>4?"#0868ac":o>2?"#2b8cbe":o>0?"#4eb3d3":"#f0f0f0"}function countProjetos(o,e){return projetosData.filter(t=>t.estado===o&&("todos"===e||t.categoria===e)).length}function groupByCategoria(o,e){const t={};return projetosData.forEach(a=>{a.estado===o&&("todos"!==e&&a.categoria!==e||(t[a.categoria]||(t[a.categoria]=[]),t[a.categoria].push(a)))}),t}function carregarMapa(){fetch("brasil_estados.geojson").then(o=>o.json()).then(o=>{geojsonLayer&&map.removeLayer(geojsonLayer),geojsonLayer=L.geoJson(o,{style:function(o){return{color:"#555",weight:1,fillColor:getColor(countProjetos(o.properties.name,document.getElementById("categoria").value)),fillOpacity:.7}},onEachFeature:function(o,e){e.on("mouseover",function(){const t=o.properties.name,a=document.getElementById("categoria").value,r=countProjetos(t,"todos"),n=groupByCategoria(t,a),i=Object.keys(n);let s=`<b>${t} (${r}/${totalGeral})</b><br><br>`;0===i.length?s+="Sem projetos nessa sele\xe7\xe3o.":i.sort((o,e)=>(categoryLabels[o]||o).localeCompare(categoryLabels[e]||e)).forEach(o=>{const e=n[o].length,t=totalPorCategoria[o]||0;s+=`<div style="margin-bottom:6px;">\n                    <u>${categoryLabels[o]||o} (${e}/${t})</u>\n                  </div>`,s+=n[o].map(o=>`<div style="margin-left:8px;">\n                      <b>${o.ict}</b>: ${o.titulo}<br><i>${o.coordenador}</i>\n                    </div>`).join("<br>"),s+="<br>"}),e.bindTooltip(s,{sticky:!0}).openTooltip()}),e.on("mouseout",function(){e.closeTooltip()})}}).addTo(map)})}let map=L.map("map").setView([-14.235,-51.9253],4);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:8}).addTo(map);const categoryLabels={veiculos_autonomos:"Ve\xedculos Aut\xf4nomos",conectividade:"Conectividade Veicular",manutencao:"Manuten\xe7\xe3o Preventiva/Preditiva",seguranca_dados:"Privacidade e Seguran\xe7a de Dados",assistencia_conducao:"Assist\xeancia \xe0 Condu\xe7\xe3o e Seguran\xe7a",logistica:"Log\xedstica, Meio Ambiente e Descarboniza\xe7\xe3o"};let geojsonLayer,projetosData=[],totalGeral=0,totalPorCategoria={};fetch("projetos.json").then(o=>o.json()).then(o=>{totalGeral=(projetosData=o).length,totalPorCategoria=projetosData.reduce((o,e)=>(o[e.categoria]=(o[e.categoria]||0)+1,o),{}),carregarMapa()}),document.getElementById("categoria").addEventListener("change",carregarMapa);