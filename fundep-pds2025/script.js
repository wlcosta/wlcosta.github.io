function getColor(e){return e>6?"#084081":e>4?"#0868ac":e>2?"#2b8cbe":e>0?"#4eb3d3":"#f0f0f0"}function countProjetos(e,o){return projetosData.filter(t=>t.estado===e&&("todos"===o||t.categoria===o)).length}function groupByCategoria(e,o){const t={};return projetosData.forEach(a=>{a.estado===e&&("todos"!==o&&a.categoria!==o||(t[a.categoria]||(t[a.categoria]=[]),t[a.categoria].push(a)))}),t}function carregarMapa(){fetch("brasil_estados.geojson").then(e=>e.json()).then(e=>{geojsonLayer&&map.removeLayer(geojsonLayer),geojsonLayer=L.geoJson(e,{style:function(e){return{color:"#555",weight:1,fillColor:getColor(countProjetos(e.properties.name,document.getElementById("categoria").value)),fillOpacity:.7}},onEachFeature:function(e,o){o.on("mouseover",function(){const t=e.properties.name,a=groupByCategoria(t,document.getElementById("categoria").value),r=Object.keys(a);if(0===r.length)return void o.bindTooltip(`<b>${t}</b><br><br>Sem projetos nessa sele\xe7\xe3o.`,{sticky:!0}).openTooltip();let n=`<b>${t}</b><br><br>`;r.sort((e,o)=>(categoryLabels[e]||e).localeCompare(categoryLabels[o]||o)).forEach(e=>{n+=`<div style="margin-bottom:6px;"><u>${categoryLabels[e]||e}</u></div>`,n+=a[e].map(e=>`<div style="margin-left:8px;">\n                    <b>${e.ict}</b>: ${e.titulo}<br><i>${e.coordenador}</i>\n                  </div>`).join("<br>"),n+="<br>"}),o.bindTooltip(n,{sticky:!0}).openTooltip()}),o.on("mouseout",function(){o.closeTooltip()})}}).addTo(map)})}let map=L.map("map").setView([-14.235,-51.9253],4);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:8}).addTo(map);const categoryLabels={veiculos_autonomos:"Ve\xedculos Aut\xf4nomos",conectividade:"Conectividade Veicular",manutencao:"Manuten\xe7\xe3o Preventiva/Preditiva",seguranca_dados:"Privacidade e Seguran\xe7a de Dados",assistencia_conducao:"Assist\xeancia \xe0 Condu\xe7\xe3o e Seguran\xe7a",logistica:"Log\xedstica, Meio Ambiente e Descarboniza\xe7\xe3o"};let geojsonLayer,projetosData=[];fetch("projetos.json").then(e=>e.json()).then(e=>{projetosData=e,carregarMapa()}),document.getElementById("categoria").addEventListener("change",carregarMapa);